<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS XML Parser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
            cursor: pointer;
            transition: all 0.2s;
        }
        button:hover {
            background: #e9ecef;
        }
        button.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        .outputs-container {
            display: flex;
            gap: 20px;
            margin: 30px 0;
        }
        .output-section {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        .output-header {
            background: #f8f9fa;
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .output-content {
            padding: 15px;
            background: white;
            max-height: 400px;
            overflow: auto;
        }
				#mediawiki-output {
						white-space: pre;
				}
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .hidden-column {
            display: none;
        }
        pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 12px;
        }
        .select-btn {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }
        .select-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RSS XML Parser</h1>
        
        <div>
            <label for="rssInput">Paste RSS XML content:</label>
            <textarea id="rssInput" placeholder="Paste your RSS XML content here..."></textarea>
        </div>
        
        <div class="controls">
            <button onclick="parseRSS()">Parse RSS</button>
            <button onclick="flipOrder()">Flip Order</button>
            
            <div style="margin-left: 20px;">
                <label>Show/Hide Columns:</label>
                <button id="toggle-title" class="active" onclick="toggleColumn('title')">Title</button>
                <button id="toggle-link" class="active" onclick="toggleColumn('link')">Link</button>
                <button id="toggle-description" class="active" onclick="toggleColumn('description')">Description</button>
                <button id="toggle-size" class="active" onclick="toggleColumn('size')">Size (MB)</button>
                <button id="toggle-dateFull" class="active" onclick="toggleColumn('dateFull')">Date Full</button>
                <button id="toggle-dateShort" class="active" onclick="toggleColumn('dateShort')">Date Short</button>
            </div>
        </div>
        
        <div class="outputs-container">
            <div class="output-section">
                <div class="output-header">
                    <h3>Table Output</h3>
                    <button class="select-btn" onclick="selectOutput('table-output')">Select</button>
                </div>
                <div class="output-content" id="table-output">
                    <p>No data parsed yet.</p>
                </div>
            </div>
            
            <div class="output-section">
                <div class="output-header">
                    <h3>MediaWiki Table</h3>
                    <button class="select-btn" onclick="selectOutput('mediawiki-output')">Select</button>
                </div>
                <div class="output-content" id="mediawiki-output">
                    <pre>No data parsed yet.</pre>
                </div>
            </div>
            
            <div class="output-section">
                <div class="output-header">
                    <h3>CSV Output</h3>
                    <button class="select-btn" onclick="selectOutput('csv-output')">Select</button>
                </div>
                <div class="output-content" id="csv-output">
                    <pre>No data parsed yet.</pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        let parsedData = [];
        let isReversed = false;
        let visibleColumns = {
            title: true,
            link: true,
            description: true,
            size: true,
            dateFull: true,
            dateShort: true
        };

        function parseRSS() {
            const input = document.getElementById('rssInput').value.trim();
            if (!input) {
                alert('Please paste RSS XML content first.');
                return;
            }

            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(input, 'text/xml');
                
                // Check for parsing errors
                const parseError = xmlDoc.querySelector('parsererror');
                if (parseError) {
                    throw new Error('Invalid XML format');
                }

                const items = xmlDoc.querySelectorAll('item');
                parsedData = [];

                items.forEach(item => {
                    const title = item.querySelector('title')?.textContent || '';
                    const link = item.querySelector('link')?.textContent || '';
                    const description = item.querySelector('description')?.textContent || '';
                    
                    // Get enclosure length and convert to MB
                    const enclosure = item.querySelector('enclosure');
                    let size = '';
                    if (enclosure && enclosure.getAttribute('length')) {
                        const bytes = parseInt(enclosure.getAttribute('length'));
                        size = (bytes / (1024 * 1024)).toFixed(2);
                    }
                    
                    // Parse date
                    const pubDate = item.querySelector('pubDate')?.textContent || '';
                    let dateFull = '';
                    let dateShort = '';
                    
                    if (pubDate) {
                        const date = new Date(pubDate);
                        if (!isNaN(date.getTime())) {
                            dateFull = date.toUTCString();
                            dateShort = date.toLocaleDateString('en-US', { 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric' 
                            });
                        }
                    }

                    parsedData.push({
                        title,
                        link,
                        description,
                        size,
                        dateFull,
                        dateShort
                    });
                });

                if (parsedData.length === 0) {
                    alert('No RSS items found in the XML.');
                    return;
                }

                generateOutputs();
            } catch (error) {
                alert('Error parsing RSS XML: ' + error.message);
            }
        }

        function flipOrder() {
            if (parsedData.length === 0) {
                alert('Please parse RSS data first.');
                return;
            }
            
            parsedData.reverse();
            isReversed = !isReversed;
            generateOutputs();
        }

        function toggleColumn(column) {
            visibleColumns[column] = !visibleColumns[column];
            const btn = document.getElementById('toggle-' + column);
            btn.classList.toggle('active', visibleColumns[column]);
            
            if (parsedData.length > 0) {
                generateOutputs();
            }
        }

        function selectOutput(outputId) {
            const element = document.getElementById(outputId);
            const range = document.createRange();
            range.selectNodeContents(element);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }

        function generateOutputs() {
            generateTableOutput();
            generateMediaWikiOutput();
            generateCSVOutput();
        }

        function generateTableOutput() {
            const tableOutput = document.getElementById('table-output');
            
            if (parsedData.length === 0) {
                tableOutput.innerHTML = '<p>No data parsed yet.</p>';
                return;
            }

            const visibleCols = Object.keys(visibleColumns).filter(col => visibleColumns[col]);
            const headers = {
                title: 'Title',
                link: 'Link',
                description: 'Description',
                size: 'Size (MB)',
                dateFull: 'Date Full',
                dateShort: 'Date Short'
            };

            let html = '<table><thead><tr>';
            visibleCols.forEach(col => {
                html += `<th class="${visibleColumns[col] ? '' : 'hidden-column'}">${headers[col]}</th>`;
            });
            html += '</tr></thead><tbody>';

            parsedData.forEach(item => {
                html += '<tr>';
                visibleCols.forEach(col => {
                    const content = col === 'link' ? `<a href="${item[col]}" target="_blank">${item[col]}</a>` : item[col];
                    html += `<td class="${visibleColumns[col] ? '' : 'hidden-column'}">${content}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableOutput.innerHTML = html;
        }

        function generateMediaWikiOutput() {
            const output = document.getElementById('mediawiki-output');
            
            if (parsedData.length === 0) {
                output.textContent = 'No data parsed yet.';
                return;
            }

            const visibleCols = Object.keys(visibleColumns).filter(col => visibleColumns[col]);
            const headers = {
                title: 'Title',
                link: 'Link',
                description: 'Description',
                size: 'Size (MB)',
                dateFull: 'Date Full',
                dateShort: 'Date Short'
            };

            let mediawiki = '{| class="wikitable"\n';
            
            // Headers
            mediawiki += '|-\n';
            visibleCols.forEach(col => {
                mediawiki += `! ${headers[col]}\n`;
            });

            // Data rows
            parsedData.forEach(item => {
                mediawiki += '|-\n';
                visibleCols.forEach(col => {
                    const content = col === 'link' ? `[${item[col]} ${item[col]}]` : item[col];
                    mediawiki += `| ${content}\n`;
                });
            });

            mediawiki += '|}';
            output.textContent = mediawiki;
        }

        function escapeCSV(str) {
            if (!str) return '""';
            // Escape quotes by doubling them and wrap in quotes
            return '"' + str.replace(/"/g, '""') + '"';
        }

        function generateCSVOutput() {
            const output = document.getElementById('csv-output');
            
            if (parsedData.length === 0) {
                output.textContent = 'No data parsed yet.';
                return;
            }

            const visibleCols = Object.keys(visibleColumns).filter(col => visibleColumns[col]);
            const headers = {
                title: 'Title',
                link: 'Link',
                description: 'Description',
                size: 'Size (MB)',
                dateFull: 'Date Full',
                dateShort: 'Date Short'
            };

            let csv = '';
            
            // Headers
            csv += visibleCols.map(col => escapeCSV(headers[col])).join(',') + '\n';
            
            // Data rows
            parsedData.forEach(item => {
                csv += visibleCols.map(col => escapeCSV(item[col])).join(',') + '\n';
            });

            output.textContent = csv;
        }
    </script>
  <nav><a href="https://github.com/qubodup/patreon-rss-xml-to-table">GitHub project</a> | <a href="https://qubodup.github.io/patreon-rss-xml-to-table/simple.html">Simple</a></nav>
</body>

</html>
